<!DOCTYPE html>
<html lang="en-US" class="glue-flexbox">
  <head>
    <title>AIP-4110: Application Default Credentials</title>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link href="//fonts.googleapis.com/css?family=Roboto:100,300,400,500,700|Google+Sans:400,500|Product+Sans:400&amp;lang=en" rel="stylesheet"></link>
    <link rel="shortcut icon" href="/assets/favicon.ico">
    <link rel="stylesheet" type="text/css" media="screen" href="//www.gstatic.com/glue/v22_1/glue.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="/assets/css/style.css?v=0e97c30a">
    <link rel="stylesheet" type="text/css" media="print" href="/assets/css/print.css?v=0e97c30a">
    <script type="text/javascript" src="//code.jquery.com/jquery-3.4.0.min.js"></script>
    <script type="text/javascript" src="//www.gstatic.com/glue/latest/glue-detect.min.js"></script>
    <script type="text/javascript">
      $('html').css('visibility', 'hidden');
      $.when($.ready).then(() => {
        $('html').css('visibility', 'visible');
      });
    </script>
    <script type="text/javascript" src="/assets/js/global.js?v=0e97c30a"></script>
    
<script type="text/javascript" src="/assets/js/proto-syntax.js"></script>
<script type="text/javascript" src="/assets/js/graphviz/viz.js?v=0e97c30a"></script>
<script type="text/javascript" src="/assets/js/graphviz/lite.render.js?v=0e97c30a"></script>
<script type="text/javascript" src="/assets/js/aip/aip-graphviz.js?v=0e97c30a"></script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140054909-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-140054909-1');
    </script>
  </head>
  <body>
    <!-- prettier-ignore -->
<header class="glue-header glue-header--single">
  <div class="glue-header__bar glue-header__bar--desktop glue-header__drawer">
    <div class="glue-header__tier">
      <!-- LOCK up-->
      <div class="glue-header__container">
        <div class="glue-header__lock-up">
          <div class="glue-header__logo">
            <a class="glue-header__logo-link" href="/" title="Google">
              <div class="glue-header__logo-container">
                <svg role="img" aria-hidden="true" class="glue-header__logo-svg">
                <use xlink:href="/assets/images/glue-icons.svg#google-color-logo"></use>
                </svg>
              </div>
              <p class="glue-header__logo--product">AIPs</p>
            </a>
          </div>
          <a href="#page-content" class="glue-header__skip-content">
            <p class="glue-header__skip-content-text">Jump to Content</p>
          </a>
        </div>
      </div>
      <!-- LINK BAR-->
      <div class="glue-header__container glue-header__container--flex-auto">
        <nav class="glue-header__link-bar">
          <ul id="list-1" class="glue-header__list">
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/general" aria-level="1">Browse AIPs</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/news" aria-level="1">News</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/faq" aria-level="1">FAQ</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/contributing" aria-level="1">Contributing</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="https://linter.aip.dev/" target="_blank" aria-level="1">
                    API Linter
                    <svg role="img" class="glue-icon glue-icon--18px">
                      <use xlink:href="/assets/images/glue-icons.svg#open-in-new"></use>
                    </svg>
                  </a>
                </li>
              
            
          </ul>
        </nav>
      </div>
      <!-- CTA-->
      <div class="glue-header__container glue-header__container--cta">
        <div class="glue-header__cta">
        <div class="glue-sitesearch">
          <form method="GET" action="/search">
          <label for="q">Search this site</label>
          <input class="glue-sitesearch__input" type="text" name="q" id="q"
            placeholder="Search AIPs">
          <button type="submit" class="glue-button glue-sitesearch__submit" title="Submit">
            <svg role="img" class="glue-icon glue-icon--24px">
            <use xlink:href="/assets/images/glue-icons.svg#search"></use>
            </svg>
          </button>
          </form>
        </div>
        <a href="https://google.aip.dev" class="glue-button glue-button--high-emphasis">
          <img src="/assets/images/github.png" class="github-logo">
          View on GitHub
        </a>
        </div>
      </div>
    </div>
  </div>
  <!-- Mobile header placeholder -->
  <div class="glue-header__bar glue-header__bar--mobile">
    <div class="glue-header__tier">
      <!-- LOCK up-->
      <div class="glue-header__container">
        <div class="glue-header__lock-up">
          <div class="glue-header__hamburger glue-header__hamburger--first-tier">
            <div class="glue-header__hamburger-wrapper">
              <button type="button" class="glue-header__drawer-toggle-btn"
                aria-controls="drawer" aria-expanded="false" aria-label="Open the navigation drawer">
                <svg role="img" class="glue-icon glue-icon--24px"><use xlink:href="/assets/images/glue-icons.svg#menu"></use></svg>
              </button>
            </div>
          </div>
          <div class="glue-header__logo">
            <a class="glue-header__logo-link" href="/" title="Google">
              <div class="glue-header__logo-container">
                <svg role="img" aria-hidden="true" class="glue-header__logo-svg">
                  <use xlink:href="/assets/images/glue-icons.svg#google-color-logo"></use>
                </svg>
              </div>
              <p class="glue-header__logo--product">AIPs</p>
            </a>
          </div>
          <!-- SKIP -->
          <a href="#page-content" class="glue-header__skip-content">
            <p class="glue-header__skip-content-text">Jump to Content</p>
          </a>
        </div>
      </div>
      <!-- CTA -->
      <div class="glue-header__container">
        <div class="glue-header__cta">
        <a href="https://github.com/aip-dev/aip.dev" class="glue-button glue-button--high-emphasis">
          <img src="/assets/images/github.png" class="github-logo">
          View on GitHub
        </a>
        </div>
      </div>
    </div>
  </div>
  <div class="glue-header__drawer-backdrop"></div>
</header>
    <div class="glue-page">
      
      <main role="main" id="page-content">
        
<nav id="aip-nav" class="docs-component-nav">
  <ul class="nav-list">
    <li class="nav-item nav-item-header">AIPs by Scope</li>
    <li class="nav-item">
      <a href="/general">General</a>
    </li>
    <li class="nav-item">
      <a href="/cloud">Google Cloud Platform</a>
    </li>
    <li class="nav-item">
      <a href="/auth">Auth</a>
    </li>
    <li class="nav-item">
      <a href="/client-libraries">Client libraries</a>
    </li>
    <li class="nav-item">
      <a href="/apps">GSuite</a>
    </li>
    <li class="nav-item">
      <a href="/aog">Actions on Google</a>
    </li>
    <li class="nav-item nav-item-header">AIPs</li>
    <li class="nav-item nav-item-active">
      <a href="/4110">
        <span class="aip-number">4110</span>
        Application Default Credentials
      </a>
    </li>
    <li class="nav-item">
      <a href="/4111">
        <span class="aip-number">4111</span>
        Self-signed JWT-based Access Token
      </a>
    </li>
    <li class="nav-item">
      <a href="/4113">
        <span class="aip-number">4113</span>
        gcloud CLI Integration
      </a>
    </li>
    <li class="nav-item">
      <a href="/4114">
        <span class="aip-number">4114</span>
        Device Certificate Authentication via Mutual TLS
      </a>
    </li>
    </ul>
</nav>
<section id="jump-content">
          
<aside id="aip-sidebar" class="docs-component-sidebar">
  <table id="aip-summary">
    <tr><th colspan="2">Application Default Credentials</th></tr>
    <tr><td>Number</td><td>4110</td></tr>
    <tr><td>Permalink</td><td><a href="https://google.aip.dev/auth/4110">google.aip.dev/auth/4110</a></td></tr>
    <tr><td>Scope</td><td>Auth</td></tr>
    <tr><td>State</td><td>Reviewing</td></tr>
    <tr><td>Created</td><td>2018-06-24</td></tr>
    <tr><td>Updated</td><td>2018-06-24</td></tr>
  </table>

  <section id="aip-toc" class="docs-component-sidebar-toc">
    <div class="toc"><span class="toctitle">Contents</span><ul>
<li><a href="#guidance">Guidance</a><ul>
<li><a href="#credential-types">Credential Types</a></li>
<li><a href="#environment-variables">Environment Variables</a></li>
<li><a href="#inputs-outputs">Inputs &amp; Outputs</a></li>
</ul>
</li>
<li><a href="#expected-behavior">Expected Behavior</a></li>
</ul>
</div>

  </section>

  <section class="docs-component-sidebar-actions">
    <ul>
      <li><a href="https://github.com/aip-dev/aip.dev/issues/">File Bug</a></li>
      <li><a href="https://github.com/aip-dev/aip.dev/blob/master/aip/auth/4110.md">View source</a></li>
      <li><a href="https://github.com/aip-dev/aip.dev/edit/master/aip/auth/4110.md">Edit this page</a></li>
    </ul>
  </section>
</aside>
<section id="aip-main" class="docs-component-main">
  <section class="section-breadcrumbs">
  <nav
    class="glue-breadcrumbs glue-mod-mt-std glue-mod-mb-std"
    aria-label="You are here."
  >
    <ol class="glue-breadcrumbs__list aip-breadcrumbs">
      <li class="glue-breadcrumbs__item" aria-level="1">
        <a class="glue-breadcrumbs__link" href="/">
          API Improvement Proposals
        </a>
      </li>
      
      <li class="glue-breadcrumbs__item" aria-level="2">
        <a class="glue-breadcrumbs__link" href="/auth">
          Auth AIPs
        </a>
      </li>
      
      <li class="glue-breadcrumbs__item glue-breadcrumbs__item--active"
          aria-level="3">
        Application Default Credentials
      </li>
    </ol>
  </nav>
</section>
  <p id="aip-state-banner" class="callout note">
  This AIP is currently under review. This means that the editors have read it
  and are in high-level concurrence, and while it is not yet fully approved, we
  have a good faith expectation that the AIP will be approved in something
  close to its current state.
</p>
  <h4 class="aip-number">AIP-4110</h4>
  <h1>Application Default Credentials</h1>
<p>Google auth libraries use a strategy called <em>Application Default Credentials
(ADC)</em> to detect and select credentials based on environment or context. With
ADC, developers should be able to run the code in different environments and
the supporting systems fetch the appropriate credentials based on each
environment in an effortless manner.</p>
<p>Auth libraries following the standards in these AIPs are known as <em>"Google
Unified Auth Clients"</em>, or <em>GUAC</em> for short. The resulting libraries are
colloquially called <em>GUACs</em>.</p>
<p><strong>Note:</strong> Because this AIP describes guidance and requirements in a
language-neutral way, it uses generic terminology which may be imprecise or
inappropriate in certain languages or environments.</p>
<h2 id="guidance">Guidance</h2>
<h3 id="credential-types">Credential Types</h3>
<p>This section outlines the supported credential types of the ADC.</p>
<ul>
<li>
<p><strong>Gcloud Credential</strong>: A credential provided by the <a href="https://cloud.google.com/sdk/gcloud/reference/auth/application-default/login">Gcloud tool</a> that
  identifies a human user that needs to authenticate to access Google APIs. The
  auth libraries <strong>must</strong> support this credential type.</p>
</li>
<li>
<p><strong>Service Account Key</strong>: A credential that identifies a non-human user that
  needs to authenticate to access Google APIs. The auth libraries <strong>must</strong>
  support this credential type.</p>
</li>
<li>
<p><strong>OAuth Client ID</strong>: A credential that identifies the client application
  which allows human users to sign-in through <a href="https://developers.google.com/identity/protocols/oauth2/native-app">3-legged OAuth flow</a>, which
  grants the permissions to the application to access Google APIs on behalf of
  the human user. The auth libraries <strong>may</strong> support this credential type.</p>
</li>
</ul>
<h3 id="environment-variables">Environment Variables</h3>
<p>The auth libraries <strong>must</strong> support the following environment variables to
allow developers to provide authentication configuration for their application:</p>
<ul>
<li>
<p><strong>GOOGLE_APPLICATION_CREDENTIALS</strong>: The specified value will be used as the
  full path for ADC to locate the credentials file. The credentials file
  <strong>should</strong> be one of the following types:</p>
<ul>
<li>Gcloud credentials</li>
<li>Service account key</li>
</ul>
<p>The credentials <strong>may</strong> be the OAuth Client ID if it is supported by the auth
library. Credentials file path specified at the program level (e.g. via
client options) <strong>must</strong> have priority over the value of this environment
variable.</p>
</li>
<li>
<p><strong>GOOGLE_API_KEY</strong>: <a href="https://cloud.google.com/docs/authentication/api-keys">API keys</a> are a simple encrypted string that
  identifies an application, which are useful for accessing public data
  anonymously. The specified value of this environment variable <strong>should</strong> be
  used as the API key for the API requests. This value <strong>must</strong> be overridden
  by any user specified credentials at the programming level (e.g. through
  client options). And it <strong>must</strong> be ignored if GOOGLE_APPLICATION_CREDENTIALS
  is specified.</p>
</li>
<li>
<p><strong>GOOGLE_API_USE_CLIENT_CERTIFICATE:</strong> The specified value <strong>must</strong> be either
  true or false. The client certificate <strong>must</strong> be ignored if this variable is
  set to false. The default value is false if the value is unset.</p>
</li>
</ul>
<div class="highlight language-"><pre><span></span><code>GOOGLE_API_USE_CLIENT_CERTIFICATE=[true|false]
</code></pre></div>

<h3 id="inputs-outputs">Inputs &amp; Outputs</h3>
<p>From the input/output perspective, the inputs of <em>ADC</em> <strong>should</strong> be the
credentials as well as the underlying environment such as environment variables
or metadata service that provides these credentials.</p>
<p>For example, the <code>GOOGLE_APPLICATION_CREDENTIALS</code> environment variable can
provide the default credential JSON as the input here, or the well-known path
that gCloud uses to store the default user credential JSON. The output is the
access token that application can use to access the Google APIs. This access
token <strong>may</strong> be a bearer token, a certificate bound token or STS depending on
the chosen authentication flow.</p>
<h2 id="expected-behavior">Expected Behavior</h2>
<p>This section outlines the expected behavior of the ADC. Auth libraries <strong>must</strong>
implement these concepts in order to be considered complete.</p>
<div class="highlight language-graphviz"><pre><span></span><code>digraph d_front_back {
  rankdir=TB;
  ranksep=0.3;
  node [ style=&quot;filled,solid&quot; shape=box fontname=&quot;Roboto&quot; ];

  check_env_var [ label=&quot;1. Check Environment Variables&quot; ];
  load_credentials [ label=&quot;2. Load Credentials&quot; ];
  check_metadata [ label=&quot;3. Check Metadata Service Credentials&quot; ];
  auth_flows [ label=&quot;4. Determine Auth Flows&quot; ];
  execute [ label=&quot;5. Execute Auth Flows&quot; ];
  sts [ label=&quot;6. Apply STS&quot; ];

  check_env_var -&gt; load_credentials -&gt; check_metadata -&gt;auth_flows -&gt; execute -&gt;
  sts;
  load_credentials -&gt; auth_flows;
}
</code></pre></div>

<ol>
<li><strong>Check environment variables</strong><ol>
<li>Check GOOGLE_APPLICATION_CREDENTIALS
    1. If set, go to step (2.2)</li>
<li>Check GOOGLE_API_KEY
    1. If set, use the provided API key <em>[END]</em></li>
<li>If neither of above is set, go to step (2)</li>
</ol>
</li>
<li><strong>Load credentials</strong></li>
<li>Check gcloud default credentials through its default path<ol>
<li>If found go to step (2.2)</li>
<li>Otherwise go to step (3)</li>
</ol>
</li>
<li>Check the provided credential type<ol>
<li>If the credential is gcloud credentials, go to step (4)</li>
<li>If the credential is a service account key JSON, go to step (4)</li>
<li>If the credential is unknown type, return an error saying that <em>[END]</em></li>
</ol>
</li>
<li>Credentials not found <em>[END]</em></li>
<li><strong>Check Metadata Service Credentials</strong></li>
<li>If true, use the metadata service flow to get an access token associated
   with the current environment <em>[END]</em></li>
<li>If false, go to step (2.3)</li>
<li><strong>Determine auth flows</strong></li>
<li>If the credential is gcloud credential go to step (5.3)</li>
<li>If scope is provided by the developer go to step (5.1)</li>
<li>Otherwise, go to step (5.2)</li>
<li><strong>Execute auth flows</strong></li>
<li>Use 2LO flow to exchange for an access token
    1. If client certificate is presented, the exchanged token will be a
       certificate bind token and then go to step (6)</li>
<li>Use self-signed JWT flow to create an access token locally.
    1. If certificate is presented, embed the certificate into the JWT and then
       go to step (6).
    2. Otherwise, use the regular self-signed JWT flow and then go to step (6)</li>
<li>Use user identity flow to exchange for an access token and then go to step
    (6)</li>
<li><strong>Check if STS is needed</strong></li>
<li>If the given TLD is not a googleapis.com domain and extra system parameters
    are provided (e.g. quota project override), call STS to exchange for a STS
    token. (a.k.a. UAT). <em>[END]</em></li>
<li>Otherwise, use the access token directly. <em>[END]</em></li>
</ol>
<!-- prettier-ignore-start -->

<!-- prettier-ignore-end -->
  <footer>
  Except as otherwise noted, the content of this page is licensed under the
  <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons
  Attribution 4.0 License</a>, and code samples are licensed under the
  <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>.
  <span class="no-print">For details, see <a href="/licensing">content
  licensing</a>.</span>
</footer>
</section>

        </section>
      </main>
      
    </div>
    <script src="//www.gstatic.com/external_hosted/hammerjs/v2_0_2/hammer.min.js"></script>
    <script src="//www.gstatic.com/glue/v22_1/glue-vanilla.min.js"></script>
    <script type="text/javascript">
      const headerElement = document.querySelector('.glue-header');
      if (headerElement) {
        new window.glue.ui.header.Header(headerElement);
      }
    </script>
  </body>
</html>